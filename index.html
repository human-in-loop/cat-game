<!doctype html>
<html>
  <head>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-select=none"
    />
    <title>Cat Hunt - Rattle Edition</title>
    <style>
      body {
        margin: 0;
        background: #000b1a;
        overflow: hidden;
        touch-action: none;
        font-family: sans-serif;
      }
      .bubble-yellow {
        position: absolute;
        width: 85px;
        height: 85px;
        border-radius: 50%;
        border: 4px solid #ffff00;
        background: rgba(255, 255, 0, 0.2);
        z-index: 5;
      }
      .bubble-blue {
        position: absolute;
        width: 85px;
        height: 85px;
        border-radius: 50%;
        border: 4px solid #00ffff;
        background: rgba(0, 255, 255, 0.2);
        z-index: 5;
      }

      /* Original Visual Style */
      .snake-body {
        position: absolute;
        width: 14px;
        height: 14px;
        border-radius: 50%;
        z-index: 4;
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.4);
      }

      #start {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 32px;
        color: white;
        background: #000;
        z-index: 100;
        cursor: pointer;
      }
      #muteBtn {
        position: fixed;
        bottom: 30px;
        left: 30px;
        padding: 12px 25px;
        background: #111;
        color: #ffff00;
        border: 2px solid #ffff00;
        border-radius: 30px;
        z-index: 110;
        font-size: 16px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div id="start">TAP TO START üêæ</div>
    <button id="muteBtn">MUTE ALL</button>

    <script>
      let audioCtx, masterGain;
      let isMuted = false;

      function initAudio() {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        masterGain = audioCtx.createGain();
        masterGain.connect(audioCtx.destination);
        if (audioCtx.state === "suspended") audioCtx.resume();
      }

      // 1. High-Pitched Pspsps (Attraction)
      function playPspsps() {
        if (!audioCtx || isMuted) return;
        const now = audioCtx.currentTime;
        for (let i = 0; i < 4; i++) {
          const t = now + i * 0.08;
          const noise = audioCtx.createBufferSource();
          const buffer = audioCtx.createBuffer(
            1,
            audioCtx.sampleRate * 0.04,
            audioCtx.sampleRate,
          );
          const data = buffer.getChannelData(0);
          for (let j = 0; j < data.length; j++) data[j] = Math.random() * 2 - 1;
          noise.buffer = buffer;
          const filter = audioCtx.createBiquadFilter();
          filter.type = "highpass";
          filter.frequency.value = 9500;
          const g = audioCtx.createGain();
          g.gain.setValueAtTime(0.15, t);
          g.gain.exponentialRampToValueAtTime(0.001, t + 0.04);
          noise.connect(filter);
          filter.connect(g);
          g.connect(masterGain);
          noise.start(t);
        }
      }

      // 2. Rattle Snake Sound (Rapid clicks)
      function playRattle() {
        if (!audioCtx || isMuted) return;
        const now = audioCtx.currentTime;
        const duration = 0.6;
        for (let i = 0; i < 15; i++) {
          const t = now + i * 0.04;
          const osc = audioCtx.createOscillator();
          const g = audioCtx.createGain();
          osc.type = "square"; // Harsh rattle texture
          osc.frequency.setValueAtTime(6000 + Math.random() * 2000, t);
          g.gain.setValueAtTime(0.03, t);
          g.gain.exponentialRampToValueAtTime(0.001, t + 0.03);
          osc.connect(g);
          g.connect(masterGain);
          osc.start(t);
          osc.stop(t + 0.03);
        }
      }

      function playPop() {
        if (!audioCtx || isMuted) return;
        const osc = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        osc.frequency.setValueAtTime(450, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(
          8000,
          audioCtx.currentTime + 0.1,
        );
        g.gain.setValueAtTime(0.1, audioCtx.currentTime);
        osc.connect(g);
        g.connect(masterGain);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
      }

      function spawnSnake() {
        const segments = [];
        const num = 45;
        const colors = ["#ffff00", "#00ffff", "#39ff14"];
        const snakeColor = colors[Math.floor(Math.random() * colors.length)];
        let x = -300,
          y = Math.random() * (window.innerHeight - 300) + 150;
        let angle = 0,
          speed = 8 + Math.random() * 4;

        for (let i = 0; i < num; i++) {
          const s = document.createElement("div");
          s.className = "snake-body";
          s.style.background = snakeColor;
          document.body.appendChild(s);
          segments.push({ el: s, x: x, y: y });
        }

        // Mix of Pspsps and Rattle on entry
        playPspsps();
        if (Math.random() > 0.5) setTimeout(playRattle, 400);

        const move = setInterval(() => {
          angle += 0.25;
          x += speed;

          // Keep rattle going randomly during slither
          if (Math.random() > 0.98) playRattle();

          if (x > window.innerWidth + 1000) {
            segments.forEach((s) => s.el.remove());
            clearInterval(move);
          }

          segments[0].x = x;
          segments[0].y = y + Math.sin(angle) * 90;
          for (let i = num - 1; i > 0; i--) {
            segments[i].x = segments[i - 1].x - 10;
            segments[i].y = segments[i - 1].y;
          }
          segments.forEach((s) => {
            s.el.style.left = s.x + "px";
            s.el.style.top = s.y + "px";
          });
        }, 25);

        segments.forEach(
          (s) =>
            (s.el.onpointerdown = (e) => {
              e.preventDefault();
              playPop();
              segments.forEach((seg) => seg.el.remove());
              clearInterval(move);
            }),
        );
      }

      function spawnBubble() {
        const b = document.createElement("div");
        b.className = Math.random() > 0.5 ? "bubble-yellow" : "bubble-blue";
        b.style.left = Math.random() * (window.innerWidth - 100) + "px";
        b.style.top = Math.random() * (window.innerHeight - 100) + "px";
        b.onpointerdown = (e) => {
          e.preventDefault();
          playPop();
          b.remove();
        };
        document.body.appendChild(b);
        setTimeout(() => {
          if (b.parentNode) b.remove();
        }, 4000);
      }

      document.getElementById("start").onclick = () => {
        initAudio();
        document.getElementById("start").style.display = "none";
        setInterval(spawnBubble, 2200);
        setInterval(spawnSnake, 6000);
        setTimeout(() => setInterval(spawnSnake, 8000), 3000);
      };

      document.getElementById("muteBtn").onclick = (e) => {
        isMuted = !isMuted;
        masterGain.gain.setTargetAtTime(
          isMuted ? 0 : 1,
          audioCtx.currentTime,
          0.05,
        );
        document.getElementById("muteBtn").textContent = isMuted
          ? "UNMUTE"
          : "MUTE ALL";
      };
    </script>
  </body>
</html>
